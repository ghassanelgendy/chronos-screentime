<Window x:Class="chronos_screentime.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:chronos_screentime"
        mc:Ignorable="d"
        Title="Chronos Screen Time Tracker"
        Background="#d0f3f9" WindowStartupLocation="CenterScreen"
        Icon="pack://application:,,,/icon.ico"
        UseLayoutRounding="True" TextOptions.TextFormattingMode="Display"
        TextOptions.TextRenderingMode="ClearType">
    
    <Window.Resources>
        <!-- Global Thin Scrollbar Styles -->
        <Style TargetType="ScrollBar">
            <Setter Property="Background" Value="#f5f5f5"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Margin" Value="0"/>
            <Setter Property="Width" Value="6"/>
            <Setter Property="MinWidth" Value="6"/>
            <Style.Triggers>
                <Trigger Property="Orientation" Value="Horizontal">
                    <Setter Property="Width" Value="Auto"/>
                    <Setter Property="MinWidth" Value="0"/>
                    <Setter Property="Height" Value="6"/>
                    <Setter Property="MinHeight" Value="6"/>
                </Trigger>
                <Trigger Property="Orientation" Value="Vertical">
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="ScrollBar">
                                <Grid Background="{TemplateBinding Background}" Width="6">
                                    <Track Name="PART_Track" IsDirectionReversed="True" Grid.Row="1">
                                        <Track.DecreaseRepeatButton>
                                            <RepeatButton Command="ScrollBar.PageUpCommand" Opacity="0" Focusable="False"/>
                                        </Track.DecreaseRepeatButton>
                                        <Track.IncreaseRepeatButton>
                                            <RepeatButton Command="ScrollBar.PageDownCommand" Opacity="0" Focusable="False"/>
                                        </Track.IncreaseRepeatButton>
                                        <Track.Thumb>
                                            <Thumb Background="#005581" BorderBrush="Transparent" Width="4" Margin="1">
                                                <Thumb.Template>
                                                    <ControlTemplate TargetType="Thumb">
                                                        <Border Background="{TemplateBinding Background}" 
                                                               CornerRadius="2" 
                                                               BorderThickness="0"
                                                               Opacity="0.7">
                                                            <Border.Style>
                                                                <Style TargetType="Border">
                                                                    <Style.Triggers>
                                                                        <Trigger Property="IsMouseOver" Value="True">
                                                                            <Setter Property="Opacity" Value="1"/>
                                                                        </Trigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </Border.Style>
                                                        </Border>
                                                    </ControlTemplate>
                                                </Thumb.Template>
                                            </Thumb>
                                        </Track.Thumb>
                                    </Track>
                                </Grid>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Trigger>
                <Trigger Property="Orientation" Value="Horizontal">
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="ScrollBar">
                                <Grid Background="{TemplateBinding Background}" Height="6">
                                    <Track Name="PART_Track" Grid.Column="1">
                                        <Track.DecreaseRepeatButton>
                                            <RepeatButton Command="ScrollBar.PageLeftCommand" Opacity="0" Focusable="False"/>
                                        </Track.DecreaseRepeatButton>
                                        <Track.IncreaseRepeatButton>
                                            <RepeatButton Command="ScrollBar.PageRightCommand" Opacity="0" Focusable="False"/>
                                        </Track.IncreaseRepeatButton>
                                        <Track.Thumb>
                                            <Thumb Background="#005581" BorderBrush="Transparent" Height="4" Margin="1">
                                                <Thumb.Template>
                                                    <ControlTemplate TargetType="Thumb">
                                                        <Border Background="{TemplateBinding Background}" 
                                                               CornerRadius="2" 
                                                               BorderThickness="0"
                                                               Opacity="0.7">
                                                            <Border.Style>
                                                                <Style TargetType="Border">
                                                                    <Style.Triggers>
                                                                        <Trigger Property="IsMouseOver" Value="True">
                                                                            <Setter Property="Opacity" Value="1"/>
                                                                        </Trigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </Border.Style>
                                                        </Border>
                                                    </ControlTemplate>
                                                </Thumb.Template>
                                            </Thumb>
                                        </Track.Thumb>
                                    </Track>
                                </Grid>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Global ScrollViewer Style -->
        <Style TargetType="ScrollViewer">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollViewer">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <ScrollContentPresenter Grid.Column="0" Grid.Row="0"/>
                            
                            <ScrollBar Grid.Column="1" Grid.Row="0"
                                     Name="PART_VerticalScrollBar"
                                     Value="{TemplateBinding VerticalOffset}"
                                     Maximum="{TemplateBinding ScrollableHeight}"
                                     ViewportSize="{TemplateBinding ViewportHeight}"
                                     Visibility="{TemplateBinding ComputedVerticalScrollBarVisibility}"/>
                            
                            <ScrollBar Grid.Column="0" Grid.Row="1"
                                     Name="PART_HorizontalScrollBar"
                                     Orientation="Horizontal"
                                     Value="{TemplateBinding HorizontalOffset}"
                                     Maximum="{TemplateBinding ScrollableWidth}"
                                     ViewportSize="{TemplateBinding ViewportWidth}"
                                     Visibility="{TemplateBinding ComputedHorizontalScrollBarVisibility}"/>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Sidebar Animation Resources -->
        <Storyboard x:Key="ShowSidebarStoryboard">
            <DoubleAnimation Storyboard.TargetName="SidebarTransform" 
                           Storyboard.TargetProperty="X"
                           To="0" Duration="0:0:0.2">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetName="SidebarBackground" 
                           Storyboard.TargetProperty="Opacity"
                           To="0.5" Duration="0:0:0.3"/>
        </Storyboard>
        
        <Storyboard x:Key="HideSidebarStoryboard">
            <DoubleAnimation Storyboard.TargetName="SidebarTransform" 
                           Storyboard.TargetProperty="X"
                           To="-280" Duration="0:0:0.2">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseIn"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetName="SidebarBackground" 
                           Storyboard.TargetProperty="Opacity"
                           To="0" Duration="0:0:0.3"/>
        </Storyboard>

        <!-- Updated Button Styles -->
        <Style x:Key="SidebarButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#005581"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="15,10"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="ButtonBorder" Background="{TemplateBinding Background}" 
                               Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" 
                                            VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="ButtonBorder" Property="Background" Value="#e6f3ff"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Updated Toggle Button Style - Always White Background -->
        <Style x:Key="SidebarToggleStyle" TargetType="Button">
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="#005581"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="Width" Value="40"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="ButtonBorder" 
                               Background="White" 
                               BorderThickness="0"
                               Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"
                                            TextElement.Foreground="{TemplateBinding Foreground}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Foreground" Value="#66b3ff"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Foreground" Value="#4da6ff"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Close Button Style for Sidebar - Always Dark Blue Background -->
        <Style x:Key="SidebarCloseButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#005581"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="Width" Value="30"/>
            <Setter Property="Height" Value="30"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="ButtonBorder" 
                               Background="#005581" 
                               BorderThickness="0"
                               CornerRadius="4"
                               Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"
                                            TextElement.Foreground="White"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="ButtonBorder" Property="Background" Value="#003d5c"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="ButtonBorder" Property="Background" Value="#002a3f"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        
        <!-- Main Content -->
        <Grid x:Name="MainContent">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <!-- Menu Bar -->
            <DockPanel Grid.Row="0">
                <!-- Sidebar Toggle Button -->
                <Button x:Name="SidebarToggleButton" DockPanel.Dock="Left"
                       Style="{StaticResource SidebarToggleStyle}"
                       Click="ToggleSidebar_Click"
                       Content="☰" VerticalAlignment="Top"/>
                
                <!-- Menu -->
                <Menu Background="#ffffff" Foreground="Black">
                    <MenuItem Header="_File" Foreground="Black">
                        <MenuItem Header="_Open Data File..." Click="OpenDataFile_Click"/>
                        <Separator/>
                        <MenuItem Header="_Export">
                            <MenuItem Header="Export as _CSV..." Click="ExportCSV_Click"/>
                            <MenuItem Header="Export _Charts..." Click="ExportCharts_Click"/>
                            <MenuItem Header="_Auto Export Settings..." Click="AutoExportSettings_Click"/>
                        </MenuItem>
                        <Separator/>
                        <MenuItem Header="E_xit" Click="Exit_Click"/>
                    </MenuItem>
                    
                    <MenuItem Header="_View" Foreground="Black">
                        <MenuItem Header="_Charts">
                            <MenuItem Header="_Pie Chart by Category" Click="ShowPieChart_Click"/>
                            <MenuItem Header="_Bar Chart by Apps" Click="ShowBarChart_Click"/>
                            <MenuItem Header="_Live Dashboard" Click="ShowLiveDashboard_Click"/>
                        </MenuItem>
                        <MenuItem Header="_Categories">
                            <MenuItem Header="Manage App _Categories..." Click="ManageCategories_Click"/>
                            <MenuItem Header="View by _Category" Click="ViewByCategory_Click"/>
                        </MenuItem>
                        <Separator/>
                        <MenuItem Name="AlwaysOnTopMenuItem" Header="_Always on Top" IsCheckable="True" Click="AlwaysOnTop_Click"/>
                        <MenuItem Name="ShowInTrayMenuItem" Header="_Show in System Tray (Minimize/Close to Tray)" IsCheckable="True" Click="ShowInTray_Click"/>
                        <MenuItem Name="HideTitleBarMenuItem" Header="_Hide Title Bar" IsCheckable="True" Click="HideTitleBar_Click"/>
                    </MenuItem>
                    
                    <MenuItem Header="_Tools" Foreground="Black">
                        <MenuItem Header="_Tracking">
                            <MenuItem Header="Track _Idle Time" IsCheckable="True" Click="TrackIdleTime_Click"/>
                            <MenuItem Header="Track _Sub-processes" IsCheckable="True" Click="TrackSubProcesses_Click"/>
                            <MenuItem Header="_Process Tree Analysis" Click="ProcessTreeAnalysis_Click"/>
                            <MenuItem Header="_Most Used Apps" Click="MostUsedApps_Click"/>
                        </MenuItem>
                        <MenuItem Header="_Productivity">
                            <MenuItem Header="Break _Notifications..." Click="BreakNotifications_Click"/>
                            <MenuItem Header="_Screen Break Notifications..." Click="ScreenBreakNotifications_Click"/>
                            <MenuItem Header="_Auto Logout Settings..." Click="AutoLogoutSettings_Click"/>
                            <MenuItem Header="_Distraction Blocking..." Click="DistractionBlocking_Click"/>
                            <MenuItem Header="_Daily/Weekly Goals..." Click="SetGoals_Click"/>
                        </MenuItem>
                        <MenuItem Header="_Health &amp; Wellness">
                            <MenuItem Header="_Screen Break Reminders..." Click="ScreenBreakNotifications_Click"/>
                            <MenuItem Header="_Eye Strain Prevention..." Click="ScreenBreakNotifications_Click"/>
                            <MenuItem Header="_Posture Reminders..." Click="BreakNotifications_Click"/>
                        </MenuItem>
                        <Separator/>
                        <MenuItem Header="_Data Management">
                            <MenuItem Header="_Merge Consecutive Entries" Click="MergeEntries_Click"/>
                            <MenuItem Header="_Backup &amp; Sync..." Click="BackupSync_Click"/>
                            <MenuItem Header="_Clean Old Data..." Click="CleanOldData_Click"/>
                        </MenuItem>
                        <Separator/>
                        <MenuItem Header="_Preferences..." Click="ShowPreferences_Click"/>
                    </MenuItem>
                    
                    <MenuItem Header="_Help" Foreground="Black">
                        <MenuItem Header="_Tutorial Mode" Click="ShowTutorial_Click"/>
                        <MenuItem Header="_Keyboard Shortcuts" Click="ShowShortcuts_Click"/>
                        <MenuItem Header="_Open Source" Click="OpenSource_Click"/>
                        <Separator/>
                        <MenuItem Header="_About Chronos" Click="ShowAbout_Click"/>
                    </MenuItem>
                </Menu>
            </DockPanel>
            
            <!-- Header -->
            <Border Grid.Row="1" Background="#005581">
                <Image Source="pack://application:,,,./assets/cover.jpg" 
                       Stretch="Fill" 
                       StretchDirection="Both"
                       HorizontalAlignment="Stretch" 
                       VerticalAlignment="Stretch"
                       UseLayoutRounding="True"
                       RenderOptions.BitmapScalingMode="HighQuality"/>
            </Border>
            
            <!-- Summary Stats -->
            <Border Grid.Row="2" Background="White" Padding="20" BorderBrush="#d0f3f9" BorderThickness="0,0,0,2">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Total Apps -->
                    <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                        <TextBlock Text="Total Apps" FontSize="12" Foreground="#005581" HorizontalAlignment="Center"
                                  UseLayoutRounding="True"
                                  TextOptions.TextFormattingMode="Display"
                                  TextOptions.TextRenderingMode="ClearType"/>
                        <TextBlock x:Name="TotalAppsText" Text="0" FontSize="24" FontWeight="Bold" 
                                  Foreground="#005581" HorizontalAlignment="Center"
                                  UseLayoutRounding="True"
                                  TextOptions.TextFormattingMode="Display"
                                  TextOptions.TextRenderingMode="ClearType"/>
                    </StackPanel>
                    
                    <!-- Total Time -->
                    <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                        <TextBlock x:Name="TimeLabel" Text="Today's Screen Time" FontSize="12" Foreground="#005581" HorizontalAlignment="Center"
                                  UseLayoutRounding="True"
                                  TextOptions.TextFormattingMode="Display"
                                  TextOptions.TextRenderingMode="ClearType"/>
                        <TextBlock x:Name="TotalTimeText" Text="0h 0m" FontSize="24" FontWeight="Bold" 
                                  Foreground="#005581" HorizontalAlignment="Center"
                                  UseLayoutRounding="True"
                                  TextOptions.TextFormattingMode="Display"
                                  TextOptions.TextRenderingMode="ClearType"/>
                    </StackPanel>
                    
                    <!-- Total Switches -->
                    <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                        <TextBlock x:Name="SwitchesLabel" Text="Today's Switches" FontSize="12" Foreground="#005581" HorizontalAlignment="Center"
                                  UseLayoutRounding="True"
                                  TextOptions.TextFormattingMode="Display"
                                  TextOptions.TextRenderingMode="ClearType"/>
                        <TextBlock x:Name="TotalSwitchesText" Text="0" FontSize="24" FontWeight="Bold" 
                                  Foreground="#005581" HorizontalAlignment="Center"
                                  UseLayoutRounding="True"
                                  TextOptions.TextFormattingMode="Display"
                                  TextOptions.TextRenderingMode="ClearType"/>
                    </StackPanel>
                    
                    <!-- Session Status -->
                    <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                        <TextBlock Text="Current Session" FontSize="12" Foreground="#005581" HorizontalAlignment="Center"
                                  UseLayoutRounding="True"
                                  TextOptions.TextFormattingMode="Display"
                                  TextOptions.TextRenderingMode="ClearType"/>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <Ellipse x:Name="StatusIndicator" Width="8" Height="8" 
                                    Fill="#E74C3C" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <TextBlock x:Name="SessionTimeText" Text="Not tracking" FontSize="14" FontWeight="SemiBold" 
                                      VerticalAlignment="Center" Foreground="#005581"
                                      UseLayoutRounding="True"
                                      TextOptions.TextFormattingMode="Display"
                                      TextOptions.TextRenderingMode="ClearType"/>
                        </StackPanel>
                    </StackPanel>
                </Grid>
            </Border>
            
            <!-- Controls -->
            <Border Grid.Row="3" Background="#d0f3f9" Padding="20" BorderBrush="#d0f3f9" BorderThickness="0,0,0,2">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                    <Button x:Name="RefreshButton" 
                            Content="Refresh" Click="RefreshButton_Click"
                            Background="#005581" Foreground="White" 
                            Padding="20,10" Margin="10,0" FontWeight="SemiBold"
                            BorderThickness="0" Cursor="Hand" FontSize="14">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="ButtonBorder"
                                                   Background="{TemplateBinding Background}" 
                                                   CornerRadius="5" Padding="{TemplateBinding Padding}">
                                                <ContentPresenter HorizontalAlignment="Center" 
                                                                VerticalAlignment="Center"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#006699"/>
                                                    <Setter TargetName="ButtonBorder" Property="Effect">
                                                        <Setter.Value>
                                                            <DropShadowEffect Color="Black" Direction="270" 
                                                                            ShadowDepth="3" BlurRadius="8" Opacity="0.3"/>
                                                        </Setter.Value>
                                                    </Setter>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </Button.Style>
                    </Button>
                    
                    <Button x:Name="ResetButton" 
                            Content="Reset All" Click="ResetButton_Click"
                            Background="#E74C3C" Foreground="White" 
                            Padding="20,10" Margin="10,0" FontWeight="SemiBold"
                            BorderThickness="0" Cursor="Hand" FontSize="14">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="ButtonBorder"
                                                   Background="{TemplateBinding Background}" 
                                                   CornerRadius="5" Padding="{TemplateBinding Padding}">
                                                <ContentPresenter HorizontalAlignment="Center" 
                                                                VerticalAlignment="Center"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#EC7063"/>
                                                    <Setter TargetName="ButtonBorder" Property="Effect">
                                                        <Setter.Value>
                                                            <DropShadowEffect Color="Black" Direction="270" 
                                                                            ShadowDepth="3" BlurRadius="8" Opacity="0.3"/>
                                                        </Setter.Value>
                                                    </Setter>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </Button.Style>
                    </Button>
        
                </StackPanel>
            </Border>
            
            <!-- App List -->
            <ScrollViewer Grid.Row="4" VerticalScrollBarVisibility="Auto" 
                          PanningMode="VerticalOnly" 
                          ScrollViewer.CanContentScroll="True">
                <ItemsControl x:Name="AppListView" Background="Transparent" 
                             Margin="20">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <UniformGrid Columns="1"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Background="White" Margin="10" 
                                   Padding="20" CornerRadius="8" 
                                   Height="120"
                                   UseLayoutRounding="True"
                                   TextOptions.TextFormattingMode="Display"
                                   TextOptions.TextRenderingMode="ClearType">
                                <Border.Effect>
                                    <DropShadowEffect Color="#d0f3f9" Direction="270" 
                                                    ShadowDepth="2" BlurRadius="8" Opacity="0.5"/>
                                </Border.Effect>
                                <Border.ContextMenu>
                                    <ContextMenu>
                                        <MenuItem Header="Reset App Data" 
                                                 Click="ResetAppButton_Click" 
                                                 Tag="{Binding AppName}"/>
                                    </ContextMenu>
                                </Border.ContextMenu>
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- App Name -->
                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="{Binding AppName}" 
                                              FontSize="16" FontWeight="SemiBold" 
                                              Foreground="#005581" TextTrimming="CharacterEllipsis"
                                              UseLayoutRounding="True"
                                              TextOptions.TextFormattingMode="Display"
                                              TextOptions.TextRenderingMode="ClearType"/>
                                    
                                    <!-- Total Time -->
                                    <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding FormattedTotalTimeShort}" 
                                              FontSize="18" FontWeight="Bold" 
                                              Foreground="#005581" HorizontalAlignment="Right"
                                              UseLayoutRounding="True"
                                              TextOptions.TextFormattingMode="Display"
                                              TextOptions.TextRenderingMode="ClearType"/>
                                    
                                    <!-- App Details -->
                                    <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" 
                                               Margin="0,10,0,10" VerticalAlignment="Center">
                                        <TextBlock Text="{Binding ProcessPath}" 
                                                  FontSize="10" Foreground="#6699cc" 
                                                  TextTrimming="CharacterEllipsis"
                                                  UseLayoutRounding="True"
                                                  TextOptions.TextFormattingMode="Display"
                                                  TextOptions.TextRenderingMode="ClearType"/>
                                        <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                            <TextBlock Text="Sessions: " FontSize="10" Foreground="#6699cc"
                                                      UseLayoutRounding="True"
                                                      TextOptions.TextFormattingMode="Display"
                                                      TextOptions.TextRenderingMode="ClearType"/>
                                            <TextBlock Text="{Binding SessionCount}" FontSize="10" Foreground="#6699cc" FontWeight="SemiBold"
                                                      UseLayoutRounding="True"
                                                      TextOptions.TextFormattingMode="Display"
                                                      TextOptions.TextRenderingMode="ClearType"/>
                                            <TextBlock Text=" | Last: " FontSize="10" Foreground="#6699cc" Margin="10,0,0,0"
                                                      UseLayoutRounding="True"
                                                      TextOptions.TextFormattingMode="Display"
                                                      TextOptions.TextRenderingMode="ClearType"/>
                                            <TextBlock Text="{Binding LastSeen, StringFormat='{}{0:MM/dd HH:mm}'}" 
                                                      FontSize="10" Foreground="#6699cc"
                                                      UseLayoutRounding="True"
                                                      TextOptions.TextFormattingMode="Display"
                                                      TextOptions.TextRenderingMode="ClearType"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
            
            <!-- Footer -->
            <Border Grid.Row="5" Background="#005581" Padding="10">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Left side - Existing content -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Center">
                        <TextBlock Text="Made with love • " 
                                  Foreground="#d0f3f9" FontSize="11" 
                                  VerticalAlignment="Center"
                                  UseLayoutRounding="True"
                                  TextOptions.TextFormattingMode="Display"
                                  TextOptions.TextRenderingMode="ClearType"/>
                        <TextBlock VerticalAlignment="Center">
                            <Hyperlink NavigateUri="https://github.com/ghassanelgendy/chronos-screentime" 
                                      RequestNavigate="Hyperlink_RequestNavigate"
                                      Foreground="White" 
                                      TextDecorations="None">
                                <TextBlock Text="GitHub Repo" 
                                          FontSize="11"
                                          UseLayoutRounding="True"
                                          TextOptions.TextFormattingMode="Display"
                                          TextOptions.TextRenderingMode="ClearType"/>
                            </Hyperlink>
                        </TextBlock>
                    </StackPanel>
                    
                    <!-- Right side - Tracking status -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                        <TextBlock x:Name="TrackingStatusPrefix" Text="Screentime is currently being tracked click to "
                                  Foreground="#d0f3f9" FontSize="11"
                                  UseLayoutRounding="True"
                                  TextOptions.TextFormattingMode="Display"
                                  TextOptions.TextRenderingMode="ClearType"/>
                        <TextBlock x:Name="TrackingActionWord" Text="stop"
                                  Foreground="White" FontSize="11" FontWeight="Bold"
                                  Cursor="Hand" TextDecorations="Underline"
                                  UseLayoutRounding="True"
                                  TextOptions.TextFormattingMode="Display"
                                  TextOptions.TextRenderingMode="ClearType"
                                  MouseLeftButtonDown="TrackingStatusFooter_Click"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>

        <!-- Sidebar Overlay Background -->
        <Rectangle x:Name="SidebarBackground" Fill="Black" Opacity="0" 
                   MouseLeftButtonDown="CloseSidebarBackground_Click"
                   Visibility="Collapsed"/>

        <!-- Animated Sidebar - White Background -->
        <Border x:Name="Sidebar" Width="280" HorizontalAlignment="Left" 
               Background="White" 
               BorderBrush="#e0e0e0" BorderThickness="0,0,1,0"
               Visibility="Collapsed">
            <Border.Effect>
                <DropShadowEffect Color="Black" Direction="270" 
                                 ShadowDepth="5" BlurRadius="15" Opacity="0.2"/>
            </Border.Effect>
            <Border.RenderTransform>
                <TranslateTransform x:Name="SidebarTransform" X="-280"/>
            </Border.RenderTransform>
            
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel>
                    <!-- Sidebar Header -->
                    <Border Background="#005581" Padding="20,15">
                        <Grid>
                            <TextBlock Text="Quick Navigation" Foreground="White" 
                                      FontSize="16" FontWeight="Bold" 
                                      VerticalAlignment="Center"/>
                            <Button HorizontalAlignment="Right" 
                                   Content="✕" 
                                   Style="{StaticResource SidebarCloseButtonStyle}"
                                   Click="CloseSidebar_Click"/>
                        </Grid>
                    </Border>

                    <!-- Date Navigation -->
                    <StackPanel Margin="0,20,0,15">
                        <TextBlock Text="TIME PERIOD" Foreground="#005581" FontSize="11" 
                                  FontWeight="Bold" Margin="20,0,20,10"/>
                        
                        <Button Content="📅 Today" Style="{StaticResource SidebarButtonStyle}" 
                               Click="ShowToday_Click" Tag="Today"/>
                        <Button Content="📅 Yesterday" Style="{StaticResource SidebarButtonStyle}" 
                               Click="ShowYesterday_Click" Tag="Yesterday"/>
                        <Button Content="📅 This Week" Style="{StaticResource SidebarButtonStyle}" 
                               Click="ShowThisWeek_Click" Tag="ThisWeek"/>
                        <Button Content="📅 Last Week" Style="{StaticResource SidebarButtonStyle}" 
                               Click="ShowLastWeek_Click" Tag="LastWeek"/>
                        <Button Content="📅 This Month" Style="{StaticResource SidebarButtonStyle}" 
                               Click="ShowThisMonth_Click" Tag="ThisMonth"/>
                        <Button Content="📅 Custom Range..." Style="{StaticResource SidebarButtonStyle}" 
                               Click="ShowCustomRange_Click" Tag="Custom"/>
                    </StackPanel>

                    <Separator Background="#e0e0e0" Margin="20,0"/>

                    <!-- Quick Stats -->
                    <StackPanel Margin="0,15,0,15">
                        <TextBlock Text="QUICK STATS" Foreground="#005581" FontSize="11" 
                                  FontWeight="Bold" Margin="20,0,20,10"/>
                        
                        <Border Background="#f8f9fa" BorderBrush="#e0e0e0" BorderThickness="1" 
                               Margin="20,5" Padding="15" CornerRadius="5">
                            <StackPanel>
                                <TextBlock x:Name="SidebarCurrentPeriod" Text="Today" Foreground="#005581" 
                                          FontWeight="Bold" FontSize="14"/>
                                <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                    <TextBlock Text="⏱️ " Foreground="#005581"/>
                                    <TextBlock x:Name="SidebarTotalTime" Text="0h 0m" Foreground="#333"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                    <TextBlock Text="🔄 " Foreground="#005581"/>
                                    <TextBlock x:Name="SidebarSwitches" Text="0 switches" Foreground="#333"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                    <TextBlock Text="📱 " Foreground="#005581"/>
                                    <TextBlock x:Name="SidebarApps" Text="0 apps" Foreground="#333"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <Separator Background="#e0e0e0" Margin="20,0"/>

                    <!-- Categories/Filters -->
                    <StackPanel Margin="0,15,0,15">
                        <TextBlock Text="CATEGORIES" Foreground="#005581" FontSize="11" 
                                  FontWeight="Bold" Margin="20,0,20,10"/>
                        
                        <Button Content="🌐 Web Browsing" Style="{StaticResource SidebarButtonStyle}" 
                               Click="FilterByCategory_Click" Tag="WebBrowsing"/>
                        <Button Content="💻 Development" Style="{StaticResource SidebarButtonStyle}" 
                               Click="FilterByCategory_Click" Tag="Development"/>
                        <Button Content="🎮 Gaming" Style="{StaticResource SidebarButtonStyle}" 
                               Click="FilterByCategory_Click" Tag="Gaming"/>
                        <Button Content="💬 Communication" Style="{StaticResource SidebarButtonStyle}" 
                               Click="FilterByCategory_Click" Tag="Communication"/>
                        <Button Content="📝 Productivity" Style="{StaticResource SidebarButtonStyle}" 
                               Click="FilterByCategory_Click" Tag="Productivity"/>
                        <Button Content="🎵 Entertainment" Style="{StaticResource SidebarButtonStyle}" 
                               Click="FilterByCategory_Click" Tag="Entertainment"/>
                        <Button Content="📂 Show All" Style="{StaticResource SidebarButtonStyle}" 
                               Click="ShowAllCategories_Click" Tag="All"/>
                    </StackPanel>

                    <Separator Background="#e0e0e0" Margin="20,0"/>

                    <!-- Quick Actions -->
                    <StackPanel Margin="0,15,0,20">
                        <TextBlock Text="QUICK ACTIONS" Foreground="#005581" FontSize="11" 
                                  FontWeight="Bold" Margin="20,0,20,10"/>
                        
                        <Button Content="📊 View Charts" Style="{StaticResource SidebarButtonStyle}" 
                               Click="ShowLiveDashboard_Click"/>
                        <Button Content="📈 Weekly Report" Style="{StaticResource SidebarButtonStyle}" 
                               Click="ShowWeeklyReport_Click"/>
                        <Button Content="📤 Export Data" Style="{StaticResource SidebarButtonStyle}" 
                               Click="ExportCSV_Click"/>
                        <Button Content="⚙️ Preferences" Style="{StaticResource SidebarButtonStyle}" 
                               Click="ShowPreferences_Click"/>
                        <Button Content="🎯 Set Goals" Style="{StaticResource SidebarButtonStyle}" 
                               Click="SetGoals_Click"/>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </Border>
    </Grid>
</Window>

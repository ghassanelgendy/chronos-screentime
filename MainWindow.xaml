<Window x:Class="chronos_screentime.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:chronos_screentime"
        mc:Ignorable="d"
        Title="Chronos Screen Time Tracker"
        Background="#d0f3f9" WindowStartupLocation="CenterScreen"
        Icon="pack://application:,,,/icon.ico"
        UseLayoutRounding="True" TextOptions.TextFormattingMode="Display"
        TextOptions.TextRenderingMode="ClearType">
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Menu Bar -->
        <Menu Grid.Row="0" Background="#ffffff" Foreground="Black">
            <MenuItem Header="_File" Foreground="Black">
                <MenuItem Header="_Open Data File..." Click="OpenDataFile_Click"/>
                <Separator/>
                <MenuItem Header="_Export">
                    <MenuItem Header="Export as _CSV..." Click="ExportCSV_Click"/>
                    <MenuItem Header="Export _Charts..." Click="ExportCharts_Click"/>
                    <MenuItem Header="_Auto Export Settings..." Click="AutoExportSettings_Click"/>
                </MenuItem>
                <Separator/>
                <MenuItem Header="E_xit" Click="Exit_Click"/>
            </MenuItem>
            
            <MenuItem Header="_View" Foreground="Black">
                <MenuItem Header="_Charts">
                    <MenuItem Header="_Pie Chart by Category" Click="ShowPieChart_Click"/>
                    <MenuItem Header="_Bar Chart by Apps" Click="ShowBarChart_Click"/>
                    <MenuItem Header="_Live Dashboard" Click="ShowLiveDashboard_Click"/>
                </MenuItem>
                <MenuItem Header="_Categories">
                    <MenuItem Header="Manage App _Categories..." Click="ManageCategories_Click"/>
                    <MenuItem Header="View by _Category" Click="ViewByCategory_Click"/>
                </MenuItem>
                <Separator/>
                <MenuItem Header="_Always on Top" IsCheckable="True" Click="AlwaysOnTop_Click"/>
                <MenuItem Header="_Show in System Tray" IsCheckable="True" Click="ShowInTray_Click"/>
                <MenuItem Header="_Hide Title Bar" IsCheckable="True" Click="HideTitleBar_Click"/>
            </MenuItem>
            
                            <MenuItem Header="_Tools" Foreground="Black">
                <MenuItem Header="_Tracking">
                    <MenuItem Header="Track _Idle Time" IsCheckable="True" Click="TrackIdleTime_Click"/>
                    <MenuItem Header="Track _Sub-processes" IsCheckable="True" Click="TrackSubProcesses_Click"/>
                    <MenuItem Header="_Process Tree Analysis" Click="ProcessTreeAnalysis_Click"/>
                    <MenuItem Header="_Most Used Apps" Click="MostUsedApps_Click"/>
                </MenuItem>
                <MenuItem Header="_Productivity">
                    <MenuItem Header="Break _Notifications..." Click="BreakNotifications_Click"/>
                    <MenuItem Header="_Screen Break Notifications..." Click="ScreenBreakNotifications_Click"/>
                    <MenuItem Header="_Auto Logout Settings..." Click="AutoLogoutSettings_Click"/>
                    <MenuItem Header="_Distraction Blocking..." Click="DistractionBlocking_Click"/>
                    <MenuItem Header="_Daily/Weekly Goals..." Click="SetGoals_Click"/>
                </MenuItem>
                <MenuItem Header="_Health &amp; Wellness">
                    <MenuItem Header="_Screen Break Reminders..." Click="ScreenBreakNotifications_Click"/>
                    <MenuItem Header="_Eye Strain Prevention..." Click="ScreenBreakNotifications_Click"/>
                    <MenuItem Header="_Posture Reminders..." Click="BreakNotifications_Click"/>
                </MenuItem>
                <Separator/>
                <MenuItem Header="_Data Management">
                    <MenuItem Header="_Merge Consecutive Entries" Click="MergeEntries_Click"/>
                    <MenuItem Header="_Backup &amp; Sync..." Click="BackupSync_Click"/>
                    <MenuItem Header="_Clean Old Data..." Click="CleanOldData_Click"/>
                </MenuItem>
                <Separator/>
                <MenuItem Header="_Preferences..." Click="ShowPreferences_Click"/>
            </MenuItem>
            
            <MenuItem Header="_Help" Foreground="Black">
                <MenuItem Header="_Tutorial Mode" Click="ShowTutorial_Click"/>
                <MenuItem Header="_Keyboard Shortcuts" Click="ShowShortcuts_Click"/>
                <MenuItem Header="_Open Source" Click="OpenSource_Click"/>
                <Separator/>
                <MenuItem Header="_About Chronos" Click="ShowAbout_Click"/>
            </MenuItem>
        </Menu>
        
        <!-- Header -->
        <Border Grid.Row="1" Background="#005581">
            <Image Source="pack://application:,,,./assets/cover.jpg" 
                   Stretch="Fill" 
                   StretchDirection="Both"
                   HorizontalAlignment="Stretch" 
                   VerticalAlignment="Stretch"
                   UseLayoutRounding="True"
                   RenderOptions.BitmapScalingMode="HighQuality"/>
        </Border>
        
        <!-- Summary Stats -->
        <Border Grid.Row="2" Background="White" Padding="20" BorderBrush="#d0f3f9" BorderThickness="0,0,0,2">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <!-- Total Apps -->
                <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                    <TextBlock Text="Total Apps" FontSize="12" Foreground="#005581" HorizontalAlignment="Center"
                              UseLayoutRounding="True"
                              TextOptions.TextFormattingMode="Display"
                              TextOptions.TextRenderingMode="ClearType"/>
                    <TextBlock x:Name="TotalAppsText" Text="0" FontSize="24" FontWeight="Bold" 
                              Foreground="#005581" HorizontalAlignment="Center"
                              UseLayoutRounding="True"
                              TextOptions.TextFormattingMode="Display"
                              TextOptions.TextRenderingMode="ClearType"/>
                </StackPanel>
                
                <!-- Total Time -->
                <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                    <TextBlock Text="Total Screen Time" FontSize="12" Foreground="#005581" HorizontalAlignment="Center"
                              UseLayoutRounding="True"
                              TextOptions.TextFormattingMode="Display"
                              TextOptions.TextRenderingMode="ClearType"/>
                    <TextBlock x:Name="TotalTimeText" Text="0h 0m" FontSize="24" FontWeight="Bold" 
                              Foreground="#005581" HorizontalAlignment="Center"
                              UseLayoutRounding="True"
                              TextOptions.TextFormattingMode="Display"
                              TextOptions.TextRenderingMode="ClearType"/>
                </StackPanel>
                
                <!-- Total Switches -->
                <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                    <TextBlock Text="Total Switches" FontSize="12" Foreground="#005581" HorizontalAlignment="Center"
                              UseLayoutRounding="True"
                              TextOptions.TextFormattingMode="Display"
                              TextOptions.TextRenderingMode="ClearType"/>
                    <TextBlock x:Name="TotalSwitchesText" Text="0" FontSize="24" FontWeight="Bold" 
                              Foreground="#005581" HorizontalAlignment="Center"
                              UseLayoutRounding="True"
                              TextOptions.TextFormattingMode="Display"
                              TextOptions.TextRenderingMode="ClearType"/>
                </StackPanel>
                
                <!-- Session Status -->
                <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                    <TextBlock Text="Current Session" FontSize="12" Foreground="#005581" HorizontalAlignment="Center"
                              UseLayoutRounding="True"
                              TextOptions.TextFormattingMode="Display"
                              TextOptions.TextRenderingMode="ClearType"/>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <Ellipse x:Name="StatusIndicator" Width="8" Height="8" 
                                Fill="#E74C3C" VerticalAlignment="Center" Margin="0,0,5,0"/>
                        <TextBlock x:Name="SessionTimeText" Text="Not tracking" FontSize="14" FontWeight="SemiBold" 
                                  VerticalAlignment="Center" Foreground="#005581"
                                  UseLayoutRounding="True"
                                  TextOptions.TextFormattingMode="Display"
                                  TextOptions.TextRenderingMode="ClearType"/>
                    </StackPanel>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Controls -->
        <Border Grid.Row="3" Background="#d0f3f9" Padding="20" BorderBrush="#d0f3f9" BorderThickness="0,0,0,2">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                <Button x:Name="RefreshButton" 
                        Content="Refresh" Click="RefreshButton_Click"
                        Background="#005581" Foreground="White" 
                        Padding="20,10" Margin="10,0" FontWeight="SemiBold"
                        BorderThickness="0" Cursor="Hand" FontSize="14">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="ButtonBorder"
                                               Background="{TemplateBinding Background}" 
                                               CornerRadius="5" Padding="{TemplateBinding Padding}">
                                            <ContentPresenter HorizontalAlignment="Center" 
                                                            VerticalAlignment="Center"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="#006699"/>
                                                <Setter TargetName="ButtonBorder" Property="Effect">
                                                    <Setter.Value>
                                                        <DropShadowEffect Color="Black" Direction="270" 
                                                                        ShadowDepth="3" BlurRadius="8" Opacity="0.3"/>
                                                    </Setter.Value>
                                                </Setter>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                </Button>
                
                <Button x:Name="ResetButton" 
                        Content="Reset All" Click="ResetButton_Click"
                        Background="#E74C3C" Foreground="White" 
                        Padding="20,10" Margin="10,0" FontWeight="SemiBold"
                        BorderThickness="0" Cursor="Hand" FontSize="14">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="ButtonBorder"
                                               Background="{TemplateBinding Background}" 
                                               CornerRadius="5" Padding="{TemplateBinding Padding}">
                                            <ContentPresenter HorizontalAlignment="Center" 
                                                            VerticalAlignment="Center"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="#EC7063"/>
                                                <Setter TargetName="ButtonBorder" Property="Effect">
                                                    <Setter.Value>
                                                        <DropShadowEffect Color="Black" Direction="270" 
                                                                        ShadowDepth="3" BlurRadius="8" Opacity="0.3"/>
                                                    </Setter.Value>
                                                </Setter>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                </Button>
    
            </StackPanel>
        </Border>
        
        <!-- App List -->
        <ScrollViewer Grid.Row="4" VerticalScrollBarVisibility="Auto" 
                      PanningMode="VerticalOnly" 
                      ScrollViewer.CanContentScroll="True">
            <ItemsControl x:Name="AppListView" Background="Transparent" 
                         Margin="20">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <UniformGrid Columns="1"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Background="White" Margin="10" 
                               Padding="20" CornerRadius="8" 
                               Height="120"
                               UseLayoutRounding="True"
                               TextOptions.TextFormattingMode="Display"
                               TextOptions.TextRenderingMode="ClearType">
                            <Border.Effect>
                                <DropShadowEffect Color="#d0f3f9" Direction="270" 
                                                ShadowDepth="2" BlurRadius="8" Opacity="0.5"/>
                            </Border.Effect>
                            <Border.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="Reset App Data" 
                                             Click="ResetAppButton_Click" 
                                             Tag="{Binding AppName}"/>
                                </ContextMenu>
                            </Border.ContextMenu>
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- App Name -->
                                <TextBlock Grid.Row="0" Grid.Column="0" Text="{Binding AppName}" 
                                          FontSize="16" FontWeight="SemiBold" 
                                          Foreground="#005581" TextTrimming="CharacterEllipsis"
                                          UseLayoutRounding="True"
                                          TextOptions.TextFormattingMode="Display"
                                          TextOptions.TextRenderingMode="ClearType"/>
                                
                                <!-- Total Time -->
                                <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding FormattedTotalTimeShort}" 
                                          FontSize="18" FontWeight="Bold" 
                                          Foreground="#005581" HorizontalAlignment="Right"
                                          UseLayoutRounding="True"
                                          TextOptions.TextFormattingMode="Display"
                                          TextOptions.TextRenderingMode="ClearType"/>
                                
                                <!-- App Details -->
                                <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" 
                                           Margin="0,10,0,10" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding ProcessPath}" 
                                              FontSize="10" Foreground="#6699cc" 
                                              TextTrimming="CharacterEllipsis"
                                              UseLayoutRounding="True"
                                              TextOptions.TextFormattingMode="Display"
                                              TextOptions.TextRenderingMode="ClearType"/>
                                    <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                        <TextBlock Text="Sessions: " FontSize="10" Foreground="#6699cc"
                                                  UseLayoutRounding="True"
                                                  TextOptions.TextFormattingMode="Display"
                                                  TextOptions.TextRenderingMode="ClearType"/>
                                        <TextBlock Text="{Binding SessionCount}" FontSize="10" Foreground="#6699cc" FontWeight="SemiBold"
                                                  UseLayoutRounding="True"
                                                  TextOptions.TextFormattingMode="Display"
                                                  TextOptions.TextRenderingMode="ClearType"/>
                                        <TextBlock Text=" | Last: " FontSize="10" Foreground="#6699cc" Margin="10,0,0,0"
                                                  UseLayoutRounding="True"
                                                  TextOptions.TextFormattingMode="Display"
                                                  TextOptions.TextRenderingMode="ClearType"/>
                                        <TextBlock Text="{Binding LastSeen, StringFormat='{}{0:MM/dd HH:mm}'}" 
                                                  FontSize="10" Foreground="#6699cc"
                                                  UseLayoutRounding="True"
                                                  TextOptions.TextFormattingMode="Display"
                                                  TextOptions.TextRenderingMode="ClearType"/>
                                    </StackPanel>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
        
        <!-- Footer -->
        <Border Grid.Row="5" Background="#005581" Padding="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- Left side - Existing content -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Center">
                    <TextBlock Text="Made with love • " 
                              Foreground="#d0f3f9" FontSize="11" 
                              VerticalAlignment="Center"
                              UseLayoutRounding="True"
                              TextOptions.TextFormattingMode="Display"
                              TextOptions.TextRenderingMode="ClearType"/>
                    <TextBlock VerticalAlignment="Center">
                        <Hyperlink NavigateUri="https://github.com/ghassanelgendy/chronos-screentime" 
                                  RequestNavigate="Hyperlink_RequestNavigate"
                                  Foreground="White" 
                                  TextDecorations="None">
                            <TextBlock Text="GitHub Repo" 
                                      FontSize="11"
                                      UseLayoutRounding="True"
                                      TextOptions.TextFormattingMode="Display"
                                      TextOptions.TextRenderingMode="ClearType"/>
                        </Hyperlink>
                    </TextBlock>
                </StackPanel>
                
                <!-- Right side - Tracking status -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                    <TextBlock x:Name="TrackingStatusPrefix" Text="Screentime is currently being tracked click to "
                              Foreground="#d0f3f9" FontSize="11"
                              UseLayoutRounding="True"
                              TextOptions.TextFormattingMode="Display"
                              TextOptions.TextRenderingMode="ClearType"/>
                    <TextBlock x:Name="TrackingActionWord" Text="stop"
                              Foreground="White" FontSize="11" FontWeight="Bold"
                              Cursor="Hand" TextDecorations="Underline"
                              UseLayoutRounding="True"
                              TextOptions.TextFormattingMode="Display"
                              TextOptions.TextRenderingMode="ClearType"
                              MouseLeftButtonDown="TrackingStatusFooter_Click"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
